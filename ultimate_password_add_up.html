<!DOCTYPE html>
<html lang="zh-TW">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>ÁµÇÊ•µÂØÜÁ¢ºÔºàË∏©Èõ∑Á¥ØÂä†ÁâàÔºâüí£</title>
    <link href="https://fonts.googleapis.com/css2?family=Noto+Sans+TC:wght@400;700&display=swap" rel="stylesheet">
    <style>
        /* CSS Reset ÂíåÂü∫Á§éÊ®£Âºè */
        * {
            box-sizing: border-box;
            margin: 0;
            padding: 0;
            -webkit-text-size-adjust: none;
            -webkit-tap-highlight-color: transparent;
        }

        /* --- Creamy Gray Theme Color Variables --- */
        :root {
            --primary-color: #6CB652;   /* ÊüîÂíåÁöÑÁ∂†Ëâ≤Ôºå‰∏ªË¶ÅÊìç‰ΩúËâ≤ */
            --secondary-color: #4AA0E6; /* ÊüîÂíåÁöÑËóçËâ≤ÔºåÊ¨°Ë¶ÅÂº∑Ë™øËâ≤ */
            --accent-color: #FF7043;    /* ÊüîÂíåÁöÑÊ©òÁ¥ÖËâ≤ÔºåË≠¶Á§∫ÊàñÈ´ò‰∫Æ */
            --warning-color: #FFD25B;   /* ÊüîÂíåÁöÑÈªÉËâ≤ÔºåË≠¶ÂëäËâ≤ */
            --danger-color: #E55959;    /* ÊüîÂíåÁöÑÁ¥ÖËâ≤ÔºåÂ§±ÊïóÊàñË≠¶Âëä */

            --page-bg: #EAE3DA;         /* È†ÅÈù¢Êï¥È´îËÉåÊôØ */
            --game-bg-1: #F6F1E7;       /* ÈÅäÊà≤ÂÖßÈÉ®‰∏ªË¶ÅËÉåÊôØ */
            --game-bg-2: #F8F4ED;       /* ÈÅäÊà≤ÂÖßÈÉ®Ê¨°Ë¶ÅËÉåÊôØÔºåÁî®ÊñºÊ†ºÂ≠ê */
            --disabled-bg: #EFEBE5;     /* Á¶ÅÁî®ÁãÄÊÖãÁöÑËÉåÊôØ */

            --text-color-dark: #333333;  /* ËºÉÊ∑±ÁöÑÊñáÂ≠óÔºåÁî®Êñº‰∏ªË¶ÅÂÖßÂÆπ */
            --text-color-medium: #5A6B78; /* ‰∏≠Á≠âÊ∑±Ëâ≤ÊñáÂ≠óÔºåÁî®ÊñºÊ¨°Ë¶ÅÂÖßÂÆπ */
            --text-color-light-on-dark: #FFFFFF; /* Âú®Ê∑±Ëâ≤ËÉåÊôØ‰∏äÁöÑÊ∑∫Ëâ≤ÊñáÂ≠ó */

            --border-color-creamy: #D0D0BE; /* Â•∂Ê≤πËâ≤Á≥ªÈÇäÊ°ÜÔºåÊØîËÉåÊôØÁ®çÊ∑± */
            --shadow-creamy: 0 4px 15px rgba(0, 0, 0, 0.08); /* ÊüîÂíåÈô∞ÂΩ± */
            --shadow-hover-creamy: 0 6px 20px rgba(0, 0, 0, 0.12); /* ÊüîÂíåhoverÈô∞ÂΩ± */

            /* --- Áé©ÂÆ∂È°èËâ≤ËÆäÊï∏ (‰øùÊåÅÈÆÆË±î‰ª•ÂçÄÂàÜÁé©ÂÆ∂) --- */
            --player1-color: #64B5F6; /* Áé©ÂÆ∂1 ‰∫ÆËóçËâ≤ */
            --player2-color: #FFB74D; /* Áé©ÂÆ∂2 ‰∫ÆÊ©òÈªÉËâ≤ */
            --player3-color: #81C784; /* Áé©ÂÆ∂3 ‰∫ÆÁ∂†Ëâ≤ */
            --player4-color: #E57373; /* Áé©ÂÆ∂4 ‰∫ÆÁ¥ÖËâ≤ */
            --player5-color: #BA68C8; /* Áé©ÂÆ∂5 Á¥´Ëâ≤ */
            --player6-color: #C0CA33; /* Áé©ÂÆ∂6 Ê™∏Ê™¨Á∂† */
            --text-color-on-player-color: #FFFFFF; /* Áé©ÂÆ∂ÈÅ∏‰∏≠Ê†ºÂ≠ê‰∏äÁöÑÊñáÂ≠óÈ°èËâ≤ */
        }

        body {
            font-family: 'Noto Sans TC', sans-serif;
            display: flex;
            flex-direction: column;
            justify-content: flex-start;
            align-items: center;
            min-height: 100vh;
            background-color: var(--page-bg); /* È†ÅÈù¢Êï¥È´îËÉåÊôØ */
            padding: 8px;
            color: var(--text-color-dark); /* Ê∑±Ëâ≤ÊñáÂ≠ó */
            line-height: 1.4;
        }

        .game-wrapper {
            display: flex;
            flex-direction: column;
            width: 100%;
            max-width: 400px; /* ÈáùÂ∞çÊâãÊ©ü‰øùÊåÅÊúÄÂ§ßÂØ¨Â∫¶ */
            margin-top: 10px;
            gap: 12px;
        }

        .game-info-and-board-container {
            background-color: var(--game-bg-1); /* ÈÅäÊà≤ÂÖßÈÉ®‰∏ªË¶ÅËÉåÊôØ (Â•∂Ê≤πÁÅ∞) */
            padding: 12px;
            border-radius: 16px;
            box-shadow: var(--shadow-creamy);
            display: flex;
            flex-direction: column;
            align-items: center;
            position: relative;
        }

        .game-info-content {
            display: flex;
            flex-direction: column;
            align-items: center;
            width: 100%;
        }

        .game-info-content > *:not(:last-child) {
            margin-bottom: 8px;
        }
        h1 { margin-bottom: 10px !important; color: var(--primary-color); }
        .instructions { margin-bottom: 15px !important; color: var(--text-color-medium); }
        .game-stats-row { margin-bottom: 15px !important; }
        .message.active, .lose-message.active { margin-bottom: 10px !important; }

        .game-stats .stat-item:first-child {
            margin-bottom: 8px;
        }

        #gameBoard {
            margin-top: 15px;
            border-collapse: collapse;
            width: 100%;
            border: 2px solid var(--border-color-creamy); /* Â•∂Ê≤πËâ≤Á≥ªÈÇäÊ°Ü */
            table-layout: fixed;
            border-radius: 8px;
            overflow: hidden;
        }

        .game-settings-container {
            background-color: var(--game-bg-1); /* ÈÅäÊà≤ÂÖßÈÉ®‰∏ªË¶ÅËÉåÊôØ (Â•∂Ê≤πÁÅ∞) */
            padding: 20px 25px;
            border-radius: 16px;
            box-shadow: var(--shadow-creamy);
            flex-shrink: 0;
            text-align: center;
            margin-top: 15px;
        }
        .game-settings-container h2 { margin-bottom: 15px; color: var(--secondary-color); }
        .game-settings-container .settings-grid {
            margin-bottom: 20px;
            display: flex;
            flex-direction: column;
            gap: 12px;
        }

        .setting-item {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 5px 0;
        }

        .setting-item label {
            font-size: 0.95em;
            color: var(--text-color-dark); /* Ê∑±Ëâ≤ÊñáÂ≠ó */
            font-weight: 500;
        }

        .setting-item input {
            padding: 6px 10px;
            border: 1px solid var(--border-color-creamy); /* Â•∂Ê≤πËâ≤Á≥ªÈÇäÊ°Ü */
            background-color: var(--game-bg-2); /* Êõ¥Ê∑∫ÁöÑÂ•∂Ê≤πËâ≤ */
            color: var(--text-color-dark); /* Ê∑±Ëâ≤ÊñáÂ≠ó */
            border-radius: 8px;
            font-size: 0.9em;
            width: 70px;
            text-align: center;
            transition: border-color 0.3s ease, box-shadow 0.3s ease;
        }
        .setting-item input:focus {
            outline: none;
            border-color: var(--secondary-color);
            box-shadow: 0 0 0 2px rgba(74, 160, 230, 0.3);
        }

        .start-game-button {
            background-color: var(--primary-color);
            color: var(--text-color-light-on-dark); /* ÁôΩËâ≤ÊñáÂ≠ó */
            padding: 10px 20px;
            border: none;
            border-radius: 8px;
            cursor: pointer;
            font-size: 1em;
            font-weight: bold;
            transition: background-color 0.3s ease, transform 0.1s ease, box-shadow 0.3s ease;
            box-shadow: var(--shadow-creamy);
        }

        .start-game-button:hover {
            background-color: #7BC765;
            transform: translateY(-2px);
            box-shadow: var(--shadow-hover-creamy);
        }
        .start-game-button:active {
            transform: translateY(0);
            box-shadow: 0 2px 8px rgba(0, 0, 0, 0.05);
        }

        .game-stats {
            display: flex;
            flex-direction: column;
            align-items: flex-start;
            gap: 4px;
            min-width: 95px;
            flex-shrink: 0;
            margin-bottom: 12px;
        }

        .stat-item {
            font-size: 1em;
            font-weight: bold;
            display: flex;
            align-items: baseline;
            gap: 5px;
            line-height: 1.2;
            color: var(--text-color-dark); /* Ê∑±Ëâ≤ÊñáÂ≠ó */
        }
        .stat-item .stat-value {
            font-size: 1.3em;
        }
        .current-range .stat-value {
            color: var(--accent-color);
        }
        .player-turn .stat-value {
            color: var(--secondary-color);
        }
        .player-turn-color-1 { color: var(--player1-color) !important; }
        .player-turn-color-2 { color: var(--player2-color) !important; }
        .player-turn-color-3 { color: var(--player3-color) !important; }
        .player-turn-color-4 { color: var(--player4-color) !important; }
        .player-turn-color-5 { color: var(--player5-color) !important; }
        .player-turn-color-6 { color: var(--player6-color) !important; }

        .last-guess-info {
            font-size: 1em;
            font-weight: bold;
            color: var(--secondary-color);
            flex-grow: 1;
            text-align: center;
            white-space: nowrap;
            overflow: hidden;
            text-overflow: ellipsis;
            transition: all 0.3s ease;
            transform: scale(1);
            margin-top: 5px;
        }
        .last-guess-info.active-pulse {
            animation: pulse 0.6s ease-in-out;
        }

        @keyframes pulse {
            0% { transform: scale(0.95); opacity: 0.5; }
            50% { transform: scale(1.05); opacity: 1; }
            100% { transform: scale(1); opacity: 1; }
        }

        .message {
            font-weight: bold;
            font-size: 0.9em;
            text-align: center;
            line-height: 1.3;
            display: none;
            min-height: 0;
            padding: 4px 0;
            color: var(--warning-color);
        }
        .message.active {
            display: block;
        }
        .lose-message {
            font-weight: bold;
            font-size: 1.1em;
            text-align: center;
            line-height: 1.3;
            display: none;
            min-height: 0;
            padding: 8px 0;
            color: var(--danger-color);
        }
        .lose-message.active {
            display: block;
        }
        .reset-button {
            background-color: var(--primary-color);
            color: var(--text-color-light-on-dark); /* ÁôΩËâ≤ÊñáÂ≠ó */
            margin-top: 12px;
            padding: 8px 15px;
            font-size: 0.95em;
            border: none;
            border-radius: 8px;
            cursor: pointer;
            transition: background-color 0.3s ease, transform 0.1s ease, box-shadow 0.3s ease;
            box-shadow: 0 3px 8px rgba(0, 0, 0, 0.1);
        }
        .reset-button:hover {
            background-color: #FFDE7A;
            transform: translateY(-1px);
            box-shadow: 0 5px 10px rgba(0, 0, 0, 0.15);
        }
        .reset-button:active {
            transform: translateY(0);
            box-shadow: 0 1px 5px rgba(0, 0, 0, 0.08);
        }

        /* Game Board Styles */
        #gameBoard td {
            width: 10%;
            height: 35px;
            min-height: 35px;
            max-height: 35px;
            border: 1px solid var(--border-color-creamy); /* Â•∂Ê≤πËâ≤Á≥ªÈÇäÊ°Ü */
            text-align: center;
            vertical-align: middle;
            font-size: 0.75em;
            font-weight: bold;
            color: var(--text-color-dark); /* Ê∑±Ëâ≤ÊñáÂ≠ó */
            background-color: var(--game-bg-2); /* Êõ¥Ê∑∫ÁöÑÂ•∂Ê≤πËâ≤ */
            transition: background-color 0.3s ease, transform 0.1s ease, color 0.3s ease;
            cursor: pointer;
            position: relative;
            line-height: 1.2;
        }
        #gameBoard td:hover:not(.disabled):not(.player-selected) {
            background-color: #F0F0E0; /* ÊüîÂíåÁöÑhoverËÉåÊôØ */
        }
        #gameBoard td.disabled {
            background-color: var(--disabled-bg); /* Á¶ÅÁî®ËÉåÊôØ */
            color: var(--text-color-medium); /* ‰∏≠Á≠âÊ∑±Ëâ≤ÊñáÂ≠ó */
            cursor: not-allowed;
            pointer-events: none;
            opacity: 0.7;
        }
        #gameBoard td.player-selected {
            color: var(--text-color-on-player-color); /* ÁôΩËâ≤ÊñáÂ≠ó */
            transform: scale(0.9);
            box-shadow: inset 0 0 5px rgba(0,0,0,0.2);
            pointer-events: none;
            transition: background-color 0.1s ease, transform 0.1s ease, color 0.1s ease, box-shadow 0.1s ease;
        }

        /* Áé©ÂÆ∂È°èËâ≤Â∞çÊáâ */
        #gameBoard td.player-1 { background-color: var(--player1-color); }
        #gameBoard td.player-2 { background-color: var(--player2-color); }
        #gameBoard td.player-3 { background-color: var(--player3-color); }
        #gameBoard td.player-4 { background-color: var(--player4-color); }
        #gameBoard td.player-5 { background-color: var(--player5-color); }
        #gameBoard td.player-6 { background-color: var(--player6-color); }

        /* Â¶ÇÊûúÁåú‰∏≠Âú∞Èõ∑ÔºåÊï∏Â≠óËÆäÁ¥ÖËâ≤‰∏¶È°ØÁ§∫ÁÇ∏ÂΩà */
        #gameBoard td.mine-hit {
            background-color: red;
            color: red; /* Â∞áÊñáÂ≠óÈ°èËâ≤Áõ¥Êé•Ë®≠ÁÇ∫Á¥ÖËâ≤ÔºåËÄå‰∏çÊòØ‰ΩøÁî®ËÆäÊï∏Ôºå‰ª•Á¨¶ÂêàÊÇ®ÁöÑÊúüÊúõ */
            font-size: 1.1em;
            animation: pulse-red 0.5s ease-in-out 3;
            display: flex;
            box-sizing: border-box;
            align-items: flex-end;
        }
        #gameBoard td.mine-hit .bomb-icon {
            font-size: 1.2em;
            line-height: 1;
            display: block;
            width: 100%;
            box-sizing: border-box;
        }
        #gameBoard td.mine-hit sub {
            font-size: 0.6em;
            line-height: 1;
            display: block;
            width: 100%;
            text-align: right;
        }

        /* ÁÇ∏ÂΩàÂãïÁï´ÈóúÈçµÂΩ±Ê†º */
        @keyframes pulse-red {
            0% { transform: scale(0.8); opacity: 0.8; background-color: #FFEB3B; }
            50% { transform: scale(1.1); opacity: 1; background-color: #FFEB3B; }
            100% { transform: scale(1); opacity: 1; background-color: #FFEB3B; }
        }

        #gameBoard td span {
             display: flex;
             width: 100%;
             height: 100%;
             justify-content: center;
             align-items: center;
             padding: 0;
             box-sizing: border-box;
             line-height: inherit;
             font-size: inherit;
        }

        /* Ê°åÈù¢Á´ØË™øÊï¥ */
        @media (min-width: 768px) {
            body {
                padding: 20px;
                line-height: 1.5;
            }
            .game-wrapper {
                max-width: 650px;
                margin-top: 20px;
                gap: 15px;
            }
            .game-info-and-board-container {
                padding: 20px;
                border-radius: 20px;
            }
            .game-settings-container {
                padding: 25px 30px;
                border-radius: 20px;
                margin-top: 20px;
            }

            .game-info-content > *:not(:last-child) {
                margin-bottom: 10px;
            }
            h1 { font-size: 2.2em; margin-bottom: 12px !important; }
            .instructions { font-size: 0.95em; line-height: 1.6; margin-bottom: 20px !important; }
            .game-stats-row { padding: 0 15px; margin-bottom: 20px !important; }
            #gameBoard { margin-top: 20px; max-width: 450px; }
            #gameBoard td { height: 45px !important; min-height: 45px !important; max-height: 45px !important;}

            .game-settings-container h2 { margin-bottom: 18px; }
            .game-settings-container .settings-grid { margin-bottom: 25px; gap: 15px; }
            .setting-item label { font-size: 1.05em; }
            .setting-item input { padding: 8px 12px; width: 80px; font-size: 1em;}
            .start-game-button { padding: 12px 25px; font-size: 1.1em; }

            .game-stats { gap: 5px; min-width: 120px;
                margin-bottom: 15px;
            }
            .stat-item { font-size: 1.1em; gap: 6px; }
            .stat-item .stat-value { font-size: 1.4em; }
            .last-guess-info { font-size: 0.95em; line-height: 1.4; }
            .message { font-size: 1em; padding: 6px 0; line-height: 1.4;}
            .lose-message { font-size: 1.2em; padding: 10px 0; }
            .reset-button { margin-top: 15px; padding: 10px 18px; font-size: 1em; }

            #gameBoard td.mine-hit .bomb-icon {
                font-size: 1.5em;                
            }
            #gameBoard td.mine-hit sub {
                font-size: 0.7em;
            }
        }

        /* ÈáùÂ∞ç iOS Safari ÁöÑÁâπÊÆäËôïÁêÜ */
        @supports (-webkit-overflow-scrolling: touch) {
            body { -webkit-text-size-adjust: 100%; }
            #gameBoard {
                width: calc(100% - 24px) !important;
            }
            #gameBoard td {
                height: 35px !important;
                min-height: 35px !important;
                max-height: 35px !important;
            }
            input[type="number"] {
                -webkit-appearance: none;
                -moz-appearance: textfield;
                appearance: none;
            }
        }
    </style>
</head>
<body>
    <div class="game-wrapper">
        <div class="game-info-and-board-container" id="gameInfoAndBoardSection" style="display: none;">
            <div class="game-info-content">
                <h1>ÁµÇÊ•µÂØÜÁ¢ºÔºàË∏©Èõ∑Ê≠•ÈÄ≤ÁâàÔºâüí£</h1>
                <p class="instructions">Áé©ÂÆ∂Ëº™ÊµÅÂæûË°®Ê†º‰∏≠ÈÅ∏Êìá‰∏ÄÂÄãÊï∏Â≠ó„ÄÇÊØèÊ¨°ÈÅ∏ÊìáÁöÑÊï∏Â≠óÂøÖÈ†àÊØî‰∏ä‰∏ÄÂÄãÊï∏Â≠óÂ§ßÔºå‰∏îÊúÄÂ§öÂè™ËÉΩÂ§ß 3 ‰ΩçÊï∏„ÄÇÂ∞èÂøÉÔºÅÁåú‰∏≠„ÄåÁµÇÊ•µÂØÜÁ¢º„ÄçÁöÑÁé©ÂÆ∂Â∞±ÊúÉËº∏ÔºÅ</p>

                <div class="game-stats-row">
                    <div class="game-stats">
                        <div class="stat-item current-range">‰∏ã‰∏ÄÊ≠•ÁØÑÂúç: <span class="stat-value" id="nextRangeDisplay">1 - 3</span></div>
                        <div class="stat-item player-turn">Ëº™Âà∞: <span class="stat-value" id="playerTurn">Áé©ÂÆ∂ 1</span></div>
                    </div>
                    <p class="last-guess-info" id="lastGuessInfo">Ë´ãÈÅ∏ÊìáÊï∏Â≠óÔºåÂæû 1 ÈñãÂßãÔºÅ</p>
                </div>

                <p class="message" id="gameMessage"></p>
                <p class="lose-message" id="loseMessage"></p> <button class="reset-button" onclick="resetGame()" style="display: none;">ÈáçÊñ∞ÈñãÂßã</button>
            </div>

            <table id="gameBoard"></table>
        </div>

        <div class="game-settings-container" id="gameSettingsSection">
            <h2>ÈÅäÊà≤Ë®≠ÂÆö</h2>
            <div class="settings-grid">
                <div class="setting-item">
                    <label for="maxNumberInput">ÊúÄÂ§ßÂèØÈÅ∏Êï∏Â≠ó:</label>
                    <input type="number" id="maxNumberInput" min="10" value="30"> </div>
                <div class="setting-item">
                    <label for="numPlayersInput">Áé©ÂÆ∂‰∫∫Êï∏:</label>
                    <input type="number" id="numPlayersInput" min="2" max="6" value="2">
                </div>
            </div>
            <button class="start-game-button" onclick="startGame()">ÈñãÂßãÈÅäÊà≤</button>
        </div>
    </div>

    <script>
        let maxNumber = 30; // ÂàùÂßãÈ†êË®≠ÊúÄÂ§ßÂèØÈÅ∏Êï∏Â≠óÔºåÂ∑≤‰øÆÊîπÁÇ∫30
        let numPlayers = 2;  // ÂàùÂßãÈ†êË®≠Áé©ÂÆ∂‰∫∫Êï∏
        let secretNumber = 0; // ÁµÇÊ•µÂØÜÁ¢º (Ë∏©‰∏≠ËÄÖËº∏)
        let lastGuessedNumber = 0; // ‰∏ä‰∏ÄÂÄãÁé©ÂÆ∂ÁåúÁöÑÊï∏Â≠óÔºåÂàùÂßãÁÇ∫ 0 ÂÖÅË®±Âæû 1,2,3 ÈñãÂßãÈÅ∏

        let playerTurn = 1;

        const maxNumberInput = document.getElementById('maxNumberInput');
        const numPlayersInput = document.getElementById('numPlayersInput');
        const startGameButton = document.querySelector('button.start-game-button');
        const gameSettingsSection = document.getElementById('gameSettingsSection');
        const gameInfoAndBoardSection = document.getElementById('gameInfoAndBoardSection');

        const gameBoard = document.getElementById('gameBoard');
        const nextRangeDisplay = document.getElementById('nextRangeDisplay'); // È°ØÁ§∫‰∏ã‰∏ÄÊ≠•ÂèØÈÅ∏ÁØÑÂúç
        const playerTurnDisplay = document.getElementById('playerTurn');
        const lastGuessInfoDisplay = document.getElementById('lastGuessInfo'); // ÊèêÁ§∫ÊñáÂ≠ó
        const gameMessageDisplay = document.getElementById('gameMessage');     // ÈåØË™§/Ë≠¶ÂëäË®äÊÅØ
        const loseMessageDisplay = document.getElementById('loseMessage');       // ËêΩÊïóË®äÊÅØ
        const resetButton = document.querySelector('.reset-button');

        // --- Helper function for message display ---
        function showMessage(element, text) {
            element.textContent = text;
            element.classList.add('active');
        }

        function hideMessage(element) {
            element.textContent = '';
            element.classList.remove('active');
        }

        // ÂáΩÊï∏‰æÜÊõ¥Êñ∞ÊèêÁ§∫ÊñáÂ≠ó‰∏¶Ëß∏ÁôºÂãïÁï´
        function updateLastGuessInfo(text) {
            lastGuessInfoDisplay.textContent = text;
            lastGuessInfoDisplay.classList.remove('active-pulse');
            void lastGuessInfoDisplay.offsetWidth; // Âº∑Âà∂ÁÄèË¶ΩÂô®ÈáçÁπ™
            lastGuessInfoDisplay.classList.add('active-pulse');
        }

        // --- Game Logic ---
        function generateSecretNumber() {
            const minPossibleSecret = Math.max(1, Math.floor(maxNumber * 0.25));
            const maxPossibleSecret = Math.floor(maxNumber * 0.99);

            if (minPossibleSecret > maxPossibleSecret) {
                secretNumber = Math.max(1, Math.floor(maxNumber * 0.8));
            } else {
                secretNumber = Math.floor(Math.random() * (maxPossibleSecret - minPossibleSecret + 1)) + minPossibleSecret;
            }
            console.log("Secret Number (for debug):", secretNumber);
        }

        function createGameBoard() {
            gameBoard.innerHTML = '';
            const cellsPerRow = 10;
            const numRows = Math.ceil(maxNumber / cellsPerRow);

            for (let i = 0; i < numRows; i++) {
                const row = gameBoard.insertRow();
                for (let j = 0; j < cellsPerRow; j++) {
                    const cell = row.insertCell();
                    const num = i * cellsPerRow + j + 1;

                    if (num <= maxNumber) {
                        cell.setAttribute('data-value', num);
                        cell.innerHTML = `<span>${num}</span>`; // ÂàùÂßãÈ°ØÁ§∫Êï∏Â≠ó
                        cell.onclick = () => handleGuess(num, cell);
                    } else {
                        cell.style.visibility = 'hidden';
                        cell.innerHTML = '';
                        cell.onclick = null;
                    }
                }
            }
            updateBoardState();
        }

        function updateBoardState() {
            const allCells = gameBoard.querySelectorAll('td');
            const minValidNumber = lastGuessedNumber + 1;
            const maxValidNumber = Math.min(lastGuessedNumber + 3, maxNumber);

            allCells.forEach(cell => {
                const num = parseInt(cell.getAttribute('data-value'));
                const isPlayerSelected = cell.classList.contains('player-selected');
                const isMineHitCell = cell.classList.contains('mine-hit'); // Êñ∞Â¢ûÊ™¢Êü•ÊòØÂê¶ÁÇ∫ÁÇ∏ÂΩàÊ†ºÂ≠ê

                // Â¶ÇÊûúÊòØÁÇ∏ÂΩàÊ†ºÂ≠êÔºåÂâáÊ∞∏ÈÅ†‰øùÊåÅÂÖ∂ÁãÄÊÖãÔºå‰∏çÈáçÊñ∞ÂïüÁî®
                if (isMineHitCell) {
                    cell.classList.add('disabled');
                    cell.onclick = null;
                    return; // Ë∑≥ÈÅéÂæåÁ∫åÁöÑÂïüÁî®/Á¶ÅÁî®ÈÇèËºØ
                }

                if (!isNaN(num) && num >= minValidNumber && num <= maxValidNumber && !isPlayerSelected) {
                    cell.classList.remove('disabled');
                    cell.onclick = () => handleGuess(num, cell);
                } else if (!isPlayerSelected) {
                    cell.classList.add('disabled');
                    cell.onclick = null;
                }
            });

            if (minValidNumber > maxNumber) {
                nextRangeDisplay.textContent = "ÁÑ°ÂèØÈÅ∏";
            } else {
                nextRangeDisplay.textContent = `${minValidNumber} - ${maxValidNumber}`;
            }
        }

        function handleGuess(guess, cell) {
            hideMessage(gameMessageDisplay);
            hideMessage(loseMessageDisplay);

            const minValidNumber = lastGuessedNumber + 1;
            const maxValidNumber = Math.min(lastGuessedNumber + 3, maxNumber);

            if (guess < minValidNumber || guess > maxValidNumber) {
                showMessage(gameMessageDisplay, `Áé©ÂÆ∂ ${playerTurn} ÈÅ∏Êìá ${guess}„ÄÇÁÑ°ÊïàÔºÅË´ãÈÅ∏Êìá‰∏ÄÂÄã‰ªãÊñº ${minValidNumber} Âà∞ ${maxValidNumber} ÁöÑÊï∏Â≠ó„ÄÇ`);
                return;
            }

            let isMineHit = false;
            // Âà§Êñ∑Êï¥ÂÄãÈÅ∏ÊìáÁØÑÂúçÊòØÂê¶ÂåÖÂê´ secretNumber
            if (secretNumber >= minValidNumber && secretNumber <= guess) {
                isMineHit = true;
            }

            for (let i = minValidNumber; i <= guess; i++) {
                const targetCell = gameBoard.querySelector(`td[data-value="${i}"]`);
                if (targetCell) {
                    targetCell.classList.remove('selected');
                    // Á¢∫‰øùÁßªÈô§ÊâÄÊúâ player-X È°ûÔºåÈò≤Ê≠¢Â§öÂÄãÈ°ûÊÆòÁïô
                    for (let p = 1; p <= numPlayers; p++) {
                        targetCell.classList.remove(`player-${p}`);
                    }
                    targetCell.classList.add('player-selected', `player-${playerTurn}`);
                    targetCell.classList.add('disabled');
                    targetCell.onclick = null;

                    if (isMineHit && i === secretNumber) {
                        targetCell.classList.add('mine-hit');
                        // È°ØÁ§∫ÁÇ∏ÂΩàÂúñÁ§∫ÂíåÊï∏Â≠ó
                        targetCell.innerHTML = `<span class="bomb-icon">üí£</span><sub>${secretNumber}</sub>`;
                    } else { // Ê≠£Â∏∏Ë¢´ÈÅ∏‰∏≠ÁöÑÊï∏Â≠ó
                        targetCell.classList.remove('mine-hit'); // ÁßªÈô§ÂèØËÉΩÁöÑmine-hitÈ°û
                        targetCell.innerHTML = `<span>${i}</span>`;
                    }
                }
            }

            lastGuessedNumber = guess;

            if (isMineHit) {
                showMessage(loseMessageDisplay, `Áé©ÂÆ∂ ${playerTurn} Áåú‰∏≠‰∫ÜÁµÇÊ•µÂØÜÁ¢º ${secretNumber}ÔºÅ‰Ω†Ëº∏‰∫ÜÔºÅüò≠`);
                updateLastGuessInfo(`Áé©ÂÆ∂ ${playerTurn} Ë∏©Âà∞Âú∞Èõ∑ÔºåÈÅäÊà≤ÁµêÊùüÔºÅ`);
                disableAllCells();
                resetButton.style.display = 'block';
                return;
            }

            updateLastGuessInfo(`Áé©ÂÆ∂ ${playerTurn} ÈÅ∏ÊìáÂà∞ ${guess}„ÄÇ`);
            updateBoardState(); // Êõ¥Êñ∞Ê£ãÁõ§ÁãÄÊÖã

            const nextMinValid = lastGuessedNumber + 1;
            if (nextMinValid > maxNumber) {
                showMessage(loseMessageDisplay, `Ê≤íÊúâÂèØÈÅ∏ÁöÑÊï∏Â≠ó‰∫Ü„ÄÇÁµÇÊ•µÂØÜÁ¢ºÊòØ ${secretNumber}„ÄÇÊâÄÊúâÁé©ÂÆ∂ÈÉΩÂÆâÂÖ®ÔºÅ`);
                updateLastGuessInfo(`ÈÅäÊà≤ÁµêÊùü„ÄÇÁµÇÊ•µÂØÜÁ¢ºÊòØ ${secretNumber}„ÄÇ`);
                disableAllCells();
                resetButton.style.display = 'block';
                return;
            }

            playerTurn = (playerTurn % numPlayers) + 1;
            updatePlayerTurnDisplay(); // Êõ¥Êñ∞Áé©ÂÆ∂Ëº™Ê¨°È°ØÁ§∫

            const nextMaxValid = Math.min(lastGuessedNumber + 3, maxNumber);
            updateLastGuessInfo(`Ëº™Âà∞Áé©ÂÆ∂ ${playerTurn}„ÄÇË´ãÈÅ∏Êìá‰∏ÄÂÄã‰ªãÊñº ${nextMinValid} Âà∞ ${nextMaxValid} ÁöÑÊï∏Â≠ó„ÄÇ`);
        }

        function disableAllCells() {
            gameBoard.querySelectorAll('td').forEach(cell => {
                cell.classList.add('disabled');
                cell.onclick = null;
            });
        }

        // --- ‰øÆÊ≠£ÂæåÁöÑÂáΩÊï∏ÔºöÊõ¥Êñ∞Áé©ÂÆ∂Ëº™Ê¨°È°ØÁ§∫ÁöÑÈ°èËâ≤ ---
        function updatePlayerTurnDisplay() {
            // ÁßªÈô§ÊâÄÊúâËàäÁöÑÈ°èËâ≤È°û
            for (let i = 1; i <= 6; i++) { // ÂÅáË®≠ÊúÄÂ§ö6ÂÄãÁé©ÂÆ∂
                playerTurnDisplay.classList.remove(`player-turn-color-${i}`);
            }
            // Ê∑ªÂä†Áï∂ÂâçÁé©ÂÆ∂ÁöÑÈ°èËâ≤È°û
            playerTurnDisplay.classList.add(`player-turn-color-${playerTurn}`);
            playerTurnDisplay.textContent = `Áé©ÂÆ∂ ${playerTurn}`;
        }

        function updateGameDisplay() {
            updatePlayerTurnDisplay(); // ÂàùÂßãÂåñÊôÇ‰πüÂëºÂè´
            const initialMin = lastGuessedNumber + 1;
            const initialMax = Math.min(lastGuessedNumber + 3, maxNumber);
            nextRangeDisplay.textContent = `${initialMin} - ${initialMax}`;
            updateLastGuessInfo('Ë´ãÈÅ∏ÊìáÊï∏Â≠óÔºåÂæû 1 ÈñãÂßãÔºÅ');
            hideMessage(gameMessageDisplay);
            hideMessage(loseMessageDisplay);
            resetButton.style.display = 'none';
        }

        function resetGame() {
            maxNumber = parseInt(maxNumberInput.value);
            numPlayers = parseInt(numPlayersInput.value);

            lastGuessedNumber = 0;
            playerTurn = 1;

            generateSecretNumber();

            updateGameDisplay();
            createGameBoard(); // ÈáçÊñ∞Áπ™Ë£ΩÊ£ãÁõ§‰ª•Ê∏ÖÈô§È°èËâ≤ÂíåÁãÄÊÖã

            gameSettingsSection.style.display = 'block';
            gameInfoAndBoardSection.style.display = 'none';

            maxNumberInput.disabled = false;
            numPlayersInput.disabled = false;
            startGameButton.disabled = false;
        }

        function startGame() {
            const enteredMaxNumber = parseInt(maxNumberInput.value);
            const enteredNumPlayers = parseInt(numPlayersInput.value);

            if (isNaN(enteredMaxNumber) || enteredMaxNumber < 10) {
                showMessage(gameMessageDisplay, "ÊúÄÂ§ßÂèØÈÅ∏Êï∏Â≠óËá≥Â∞ëË¶Å 10ÔºÅ");
                return;
            }
            if (isNaN(enteredNumPlayers) || enteredNumPlayers < 2 || enteredNumPlayers > 6) {
                showMessage(gameMessageDisplay, "Áé©ÂÆ∂‰∫∫Êï∏Ë´ãËº∏ÂÖ• 2 Âà∞ 6 ‰πãÈñìÔºÅ");
                return;
            }

            maxNumber = enteredMaxNumber;
            numPlayers = enteredNumPlayers;

            lastGuessedNumber = 0;
            playerTurn = 1;

            generateSecretNumber();

            gameSettingsSection.style.display = 'none';
            gameInfoAndBoardSection.style.display = 'flex';

            maxNumberInput.disabled = true;
            numPlayersInput.disabled = true;
            startGameButton.disabled = true;

            createGameBoard();
            updateGameDisplay(); // ÂàùÂßãÂåñÈ°ØÁ§∫ÂÖßÂÆπ
        }

        // Initial setup when page loads
        gameInfoAndBoardSection.style.display = 'none';
        gameSettingsSection.style.display = 'block';

        // ÂàùÂßãËºâÂÖ•ÊôÇÈ°ØÁ§∫ÁØÑÂúçÁöÑÈ†êË®≠ÊèêÁ§∫
        nextRangeDisplay.textContent = `1 - 3`;
    </script>
</body>
</html>

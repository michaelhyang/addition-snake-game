<!DOCTYPE html>
<html lang="zh-TW">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>çµ‚æ¥µå¯†ç¢¼éŠæˆ² ğŸ”’</title>
    <link href="https://fonts.googleapis.com/css2?family=Noto+Sans+TC:wght@400;700&display=swap" rel="stylesheet">
    <style>
        /* CSS Reset å’ŒåŸºç¤æ¨£å¼ */
        * {
            box-sizing: border-box; 
            margin: 0; 
            padding: 0; 
            -webkit-text-size-adjust: none; 
            -webkit-tap-highlight-color: transparent;
        }

        /* --- Dark Theme Color Variables --- */
        :root {
            --primary-color: #8BC34A;   /* äº®ç¶ è‰²ï¼Œä¸»è¦æ“ä½œè‰² */
            --secondary-color: #64B5F6; /* äº®è—è‰²ï¼Œæ¬¡è¦å¼·èª¿è‰² */
            --accent-color: #FF8A65;    /* äº®æ©˜è‰²/çŠç‘šè‰²ï¼Œè­¦ç¤ºæˆ–é«˜äº® */
            --warning-color: #FFD54F;   /* äº®é»ƒè‰²ï¼Œè­¦å‘Šè‰² */
            
            --dark-bg-1: #212121;       /* æœ€æš—çš„èƒŒæ™¯è‰²ï¼Œç”¨æ–¼body */
            --dark-bg-2: #2E2E2E;       /* æ¬¡æš—çš„èƒŒæ™¯è‰²ï¼Œç”¨æ–¼å¡ç‰‡æˆ–ä¸»è¦å®¹å™¨ */
            --dark-bg-3: #3A3A3A;       /* ç¨äº®çš„èƒŒæ™¯è‰²ï¼Œç”¨æ–¼è¼¸å…¥æ¡†æˆ–æ¬¡è¦å…ƒç´  */
            --dark-bg-4-disabled: #282828; /* æ›´æš—çš„èƒŒæ™¯è‰²ï¼Œç”¨æ–¼ç¦ç”¨ç‹€æ…‹çš„æ ¼å­ */
            
            --text-color-light: #E0E0E0; /* æ·ºè‰²æ–‡å­—ï¼Œç”¨æ–¼ä¸»è¦å…§å®¹ */
            --text-color-medium: #B0B0B0; /* ä¸­ç­‰æ·ºè‰²æ–‡å­—ï¼Œç”¨æ–¼æ¬¡è¦å…§å®¹ */
            --text-color-dark: #757575; /* æš—è‰²æ–‡å­—ï¼Œç”¨æ–¼èªªæ˜æ€§æ–‡å­—æˆ–èƒŒæ™¯ä¸Šçš„é»ç¶´ */
            --text-color-disabled: #555555; /* ç¦ç”¨æ–‡å­—é¡è‰² */
            
            --border-color-dark: #424242; /* æš—è‰²é‚Šæ¡† */
            --shadow-dark: 0 4px 15px rgba(0, 0, 0, 0.4); 
            --shadow-hover-dark: 0 6px 20px rgba(0, 0, 0, 0.6);

            --white-bg: #FFFFFF; 
        }

        body {
            font-family: 'Noto Sans TC', sans-serif;
            display: flex;
            flex-direction: column;
            justify-content: flex-start;
            align-items: center;
            min-height: 100vh;
            background-color: var(--dark-bg-1); 
            padding: 8px; 
            color: var(--text-color-light); 
            line-height: 1.4; 
        }

        .game-wrapper {
            display: flex;
            flex-direction: column;
            width: 100%;
            max-width: 400px; 
            margin-top: 10px; 
            gap: 12px; 
        }

        .game-info-and-board-container { 
            background-color: var(--dark-bg-2); 
            padding: 12px; 
            border-radius: 16px; 
            box-shadow: var(--shadow-dark); 
            display: flex;
            flex-direction: column; 
            align-items: center; 
            position: relative; 
        }
        
        .game-info-content {
            display: flex;
            flex-direction: column;
            align-items: center; 
            width: 100%; 
        }

        .game-info-content > *:not(:last-child) {
            margin-bottom: 8px; 
        }
        h1 { margin-bottom: 10px !important; } 
        .instructions { margin-bottom: 15px !important; } 
        .game-stats-row { margin-bottom: 15px !important; } 
        .message.active, .win-message.active { margin-bottom: 10px !important; } 


        #gameBoard {
            margin-top: 15px; 
            border-collapse: collapse;
            width: 100%;
            max-width: 350px; 
            aspect-ratio: 1 / 1; 
            border: 2px solid var(--border-color-dark); 
            table-layout: fixed;
            border-radius: 8px; 
            overflow: hidden; 
        }

        .game-settings-container { 
            background-color: var(--dark-bg-2); 
            padding: 20px 25px; 
            border-radius: 16px; 
            box-shadow: var(--shadow-dark); 
            flex-shrink: 0;
            text-align: center;
            margin-top: 15px; 
        }
        .game-settings-container h2 { margin-bottom: 15px; } 
        .game-settings-container .settings-grid { 
            margin-bottom: 20px; 
            display: flex;
            flex-direction: column;
            gap: 12px; 
        }

        .setting-item {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 5px 0; 
        }

        .setting-item label {
            font-size: 0.95em; 
            color: var(--text-color-light); 
            font-weight: 500; 
        }

        .setting-item input {
            padding: 6px 10px; 
            border: 1px solid var(--border-color-dark); 
            background-color: var(--dark-bg-3); 
            color: var(--text-color-light); 
            border-radius: 8px; 
            font-size: 0.9em;
            width: 70px; 
            text-align: center; 
            transition: border-color 0.3s ease, box-shadow 0.3s ease;
        }
        .setting-item input:focus {
            outline: none;
            border-color: var(--secondary-color); 
            box-shadow: 0 0 0 2px rgba(100, 181, 246, 0.3); 
        }

        .start-game-button {
            background-color: var(--primary-color); 
            color: var(--dark-bg-1); 
            padding: 10px 20px; 
            border: none;
            border-radius: 8px; 
            cursor: pointer;
            font-size: 1em;
            font-weight: bold;
            transition: background-color 0.3s ease, transform 0.1s ease, box-shadow 0.3s ease;
            box-shadow: var(--shadow-dark);
        }

        .start-game-button:hover {
            background-color: #7CB342; 
            transform: translateY(-2px);
            box-shadow: var(--shadow-hover-dark);
        }
        .start-game-button:active {
            transform: translateY(0);
            box-shadow: 0 2px 8px rgba(0, 0, 0, 0.2);
        }

        h1 {
            color: var(--primary-color); 
            font-size: 1.8em; 
            text-align: center; 
            width: 100%; 
            line-height: 1.2; 
            font-weight: 700;
        }

        h2 {
            color: var(--secondary-color); 
            font-size: 1.3em; 
            line-height: 1.2; 
            font-weight: 600;
        }

        .instructions {
            font-size: 0.8em; 
            line-height: 1.5; 
            color: var(--text-color-medium); 
            padding: 0 5px; 
            text-align: center;
        }

        /* èª¿æ•´å¾Œçš„ä½ˆå±€ */
        .game-stats-row {
            display: flex;
            justify-content: space-between; 
            align-items: center; 
            width: 100%;
            padding: 0 8px; 
            line-height: 1.2; 
        }

        .game-stats {
            display: flex;
            flex-direction: column; 
            align-items: flex-start; 
            gap: 4px; 
            min-width: 95px; 
            flex-shrink: 0; 
        }

        .stat-item {
            font-size: 1em; 
            font-weight: bold;
            display: flex; 
            align-items: baseline; 
            gap: 5px; 
            line-height: 1.2; 
            color: var(--text-color-light); 
        }
        .stat-item .stat-value {
            font-size: 1.3em; 
        }
        .current-range .stat-value {
            color: var(--accent-color); 
        }
        .player-turn .stat-value {
            color: var(--secondary-color); 
        }

        /* èª¿æ•´å¾Œçš„æç¤ºæ–‡å­—æ¨£å¼ */
        .last-guess-info {
            font-size: 1em; /* å­—é«”å¤§å°ç•¥å¢ */
            font-weight: bold; /* åŠ ç²—ï¼Œæ›´é¡¯çœ¼ */
            color: var(--secondary-color); /* äº®è—è‰²ï¼Œæ›´æ´»æ½‘ */
            flex-grow: 1; 
            text-align: center; /* åœ¨å¯ç”¨ç©ºé–“å…§ç½®ä¸­å°é½Š */
            white-space: nowrap; 
            overflow: hidden; 
            text-overflow: ellipsis; 
            transition: all 0.3s ease; /* æ–°å¢éæ¸¡æ•ˆæœ */
            transform: scale(1); /* é è¨­å¤§å° */
        }
        .last-guess-info.active-pulse {
            animation: pulse 0.6s ease-in-out; /* æ–°å¢å‹•ç•« */
        }

        /* æç¤ºæ–‡å­—çš„å‹•ç•« */
        @keyframes pulse {
            0% { transform: scale(0.95); opacity: 0.5; }
            50% { transform: scale(1.05); opacity: 1; }
            100% { transform: scale(1); opacity: 1; }
        }
        
        .message, .win-message {
            font-weight: bold;
            font-size: 0.9em; 
            text-align: center; 
            line-height: 1.3; 
            display: none; 
            min-height: 0; 
            padding: 4px 0; 
        }
        .message.active, .win-message.active {
            display: block; 
        }
        .message {
            color: #EF5350; /* éŒ¯èª¤ç´… */
        }
        .win-message {
            color: var(--primary-color); 
            font-size: 1.1em; 
            padding: 8px 0; 
        }
        .reset-button {
            background-color: var(--warning-color); 
            color: var(--dark-bg-1); 
            margin-top: 12px; 
            padding: 8px 15px; 
            font-size: 0.95em; 
            border: none;
            border-radius: 8px; 
            cursor: pointer;
            transition: background-color 0.3s ease, transform 0.1s ease, box-shadow 0.3s ease;
            box-shadow: 0 3px 8px rgba(0, 0, 0, 0.2);
        }
        .reset-button:hover {
            background-color: #FFC107; 
            transform: translateY(-1px);
            box-shadow: 0 5px 10px rgba(0, 0, 0, 0.3);
        }
        .reset-button:active {
            transform: translateY(0);
            box-shadow: 0 1px 5px rgba(0, 0, 0, 0.2);
        }

        /* Game Board Styles */
        #gameBoard td {
            width: 10%;
            height: 35px; 
            min-height: 35px; 
            max-height: 35px; 
            border: 1px solid var(--border-color-dark); 
            text-align: center;
            vertical-align: middle;
            font-size: 0.75em; 
            font-weight: bold;
            color: var(--text-color-light); /* æ­£å¸¸å¯é¸æ•¸å­—é¡è‰² */
            background-color: var(--dark-bg-3); 
            transition: background-color 0.3s ease, transform 0.1s ease, color 0.3s ease;
            cursor: pointer; /* å¯é»æ“Š */
            position: relative;
            line-height: 1.2; 
        }
        #gameBoard td:hover:not(.disabled):not(.selected) {
            background-color: #4A4A4A; /* æ‡¸åœæ™‚é¡è‰²è®Šæ·± */
        }
        #gameBoard td.disabled {
            background-color: var(--dark-bg-4-disabled); /* ç¦ç”¨èƒŒæ™¯è‰² */
            color: var(--text-color-disabled); /* ç¦ç”¨æ–‡å­—é¡è‰² */
            cursor: not-allowed;
            pointer-events: none; /* å®Œå…¨ç¦ç”¨é»æ“Šäº‹ä»¶ */
            opacity: 0.7; /* ç¨å¾®é€æ˜ */
        }
        #gameBoard td.selected {
            background-color: var(--secondary-color); /* è¢«é¸ä¸­æ•¸å­—çš„èƒŒæ™¯è‰² */
            color: var(--dark-bg-1); /* è¢«é¸ä¸­æ•¸å­—çš„æ–‡å­—é¡è‰² */
            transform: scale(0.9); /* é»æ“Šå‹•ç•«ï¼šç¸®å° */
            box-shadow: inset 0 0 5px rgba(0,0,0,0.4);
            transition: background-color 0.1s ease, transform 0.1s ease, color 0.1s ease, box-shadow 0.1s ease;
            pointer-events: none; /* è¢«é¸ä¸­å¾Œä¸èƒ½å†é»æ“Š */
        }
        #gameBoard td span {
             display: flex; 
             width: 100%;
             height: 100%;
             justify-content: center;
             align-items: center;
             padding: 0; 
             box-sizing: border-box;
             line-height: inherit; 
             font-size: inherit; 
        }

        /* æ¡Œé¢ç«¯èª¿æ•´ */
        @media (min-width: 768px) {
            body {
                padding: 20px; 
                line-height: 1.5; 
            }
            .game-wrapper {
                max-width: 650px; 
                margin-top: 20px;
                gap: 15px; 
            }
            .game-info-and-board-container { 
                padding: 20px; 
                border-radius: 20px;
            }
            .game-settings-container {
                padding: 25px 30px; 
                border-radius: 20px;
                margin-top: 20px;
            }

            .game-info-content > *:not(:last-child) {
                margin-bottom: 10px; 
            }
            h1 { font-size: 2.2em; margin-bottom: 12px !important; }
            .instructions { font-size: 0.95em; line-height: 1.6; margin-bottom: 20px !important; } 
            .game-stats-row { padding: 0 15px; margin-bottom: 20px !important; }
            #gameBoard { margin-top: 20px; max-width: 450px; height: 450px !important;} 
            #gameBoard td { height: 45px !important; min-height: 45px !important; max-height: 45px !important;} 


            .game-settings-container h2 { margin-bottom: 18px; } 
            .game-settings-container .settings-grid { margin-bottom: 25px; gap: 15px; } 
            .setting-item label { font-size: 1.05em; }
            .setting-item input { padding: 8px 12px; width: 80px; font-size: 1em;}
            .start-game-button { padding: 12px 25px; font-size: 1.1em; }

            .game-stats { gap: 5px; min-width: 120px; }
            .stat-item { font-size: 1.1em; gap: 6px; }
            .stat-item .stat-value { font-size: 1.4em; }
            .last-guess-info { font-size: 0.95em; line-height: 1.4; } 
            .message, .win-message { font-size: 1em; padding: 6px 0; line-height: 1.4;} 
            .win-message { font-size: 1.2em; padding: 10px 0; }
            .reset-button { margin-top: 15px; padding: 10px 18px; font-size: 1em; }
        }

        /* é‡å° iOS Safari çš„ç‰¹æ®Šè™•ç† */
        @supports (-webkit-overflow-scrolling: touch) { 
            body { -webkit-text-size-adjust: 100%; }
            #gameBoard {
                width: calc(100% - 24px) !important;
                max-width: 350px !important;
                height: 350px !important;
            }
            #gameBoard td {
                height: 35px !important;
                min-height: 35px !important;
                max-height: 35px !important;
            }
            input[type="number"] {
                -webkit-appearance: none;
                -moz-appearance: textfield; 
                appearance: none;
            }
        }
    </style>
</head>
<body>
    <div class="game-wrapper">
        <div class="game-info-and-board-container" id="gameInfoAndBoardSection" style="display: none;">
            <div class="game-info-content"> 
                <h1>çµ‚æ¥µå¯†ç¢¼ ğŸ”’</h1>
                <p class="instructions">å¾è¡¨æ ¼ä¸­é¸æ“‡ä¸€å€‹æ•¸å­—ã€‚éŠæˆ²ç›®æ¨™æ˜¯çŒœä¸­çµ‚æ¥µå¯†ç¢¼ï¼æ¯æ¬¡é¸æ“‡å¾Œï¼Œæ•¸å­—ç¯„åœæœƒç¸®å°ã€‚</p>
                
                <div class="game-stats-row">
                    <div class="game-stats">
                        <div class="stat-item current-range">ç¯„åœ: <span class="stat-value" id="currentRangeDisplay">1 - 100</span></div>
                        <div class="stat-item player-turn">è¼ªåˆ°: <span class="stat-value" id="playerTurn">ç©å®¶ 1</span></div>
                    </div>
                    <p class="last-guess-info" id="lastGuessInfo">è«‹é¸æ“‡ä¸€å€‹æ•¸å­—</p>
                </div>
                
                <p class="message" id="gameMessage"></p>
                <p class="win-message" id="winMessage"></p>

                <button class="reset-button" onclick="resetGame()" style="display: none;">é‡æ–°é–‹å§‹</button>
            </div>

            <table id="gameBoard"></table>
        </div>

        <div class="game-settings-container" id="gameSettingsSection">
            <h2>éŠæˆ²è¨­å®š</h2>
            <div class="settings-grid">
                <div class="setting-item">
                    <label for="maxNumberInput">æ•¸å­—æœ€å¤§å€¼:</label>
                    <input type="number" id="maxNumberInput" min="10" value="100">
                </div>
                <div class="setting-item">
                    <label for="numPlayersInput">ç©å®¶äººæ•¸:</label>
                    <input type="number" id="numPlayersInput" min="2" max="6" value="2">
                </div>
            </div>
            <button class="start-game-button" onclick="startGame()">é–‹å§‹éŠæˆ²</button>
        </div>
    </div>

    <script>
        let maxNumber = 100;
        let numPlayers = 2;
        let secretNumber = 0; // çµ‚æ¥µå¯†ç¢¼
        let playerTurn = 1;
        let lowerBound = 1;
        let upperBound = 100;

        const maxNumberInput = document.getElementById('maxNumberInput');
        const numPlayersInput = document.getElementById('numPlayersInput');
        const startGameButton = document.querySelector('button.start-game-button');
        const gameSettingsSection = document.getElementById('gameSettingsSection');
        const gameInfoAndBoardSection = document.getElementById('gameInfoAndBoardSection'); 

        const gameBoard = document.getElementById('gameBoard');
        const currentRangeDisplay = document.getElementById('currentRangeDisplay');
        const playerTurnDisplay = document.getElementById('playerTurn');
        const lastGuessInfoDisplay = document.getElementById('lastGuessInfo');
        const gameMessageDisplay = document.getElementById('gameMessage');
        const winMessageDisplay = document.getElementById('winMessage');
        const resetButton = document.querySelector('.reset-button');

        // --- Helper function for message display ---
        function showMessage(element, text, isWin = false) {
            element.textContent = text;
            element.classList.add('active'); 
            if (isWin) {
                element.classList.add('win'); 
            } else {
                element.classList.remove('win');
            }
        }

        function hideMessage(element) {
            element.textContent = '';
            element.classList.remove('active', 'win'); 
        }

        // æ–°å¢ä¸€å€‹å‡½æ•¸ä¾†æ›´æ–°æç¤ºæ–‡å­—ä¸¦è§¸ç™¼å‹•ç•«
        function updateLastGuessInfo(text) {
            lastGuessInfoDisplay.textContent = text;
            // ç§»é™¤å†æ·»åŠ  class ä¾†è§¸ç™¼å‹•ç•«
            lastGuessInfoDisplay.classList.remove('active-pulse');
            // å¼·åˆ¶ç€è¦½å™¨é‡ç¹ªï¼Œä»¥ç¢ºä¿å‹•ç•«èƒ½è¢«å†æ¬¡è§¸ç™¼
            void lastGuessInfoDisplay.offsetWidth; 
            lastGuessInfoDisplay.classList.add('active-pulse');
        }

        // --- Game Logic ---
        function generateSecretNumber() {
            // çµ‚æ¥µå¯†ç¢¼å¿…é ˆåœ¨ 1 åˆ° maxNumber ä¹‹é–“
            secretNumber = Math.floor(Math.random() * maxNumber) + 1;
            console.log("Secret Number (for debug):", secretNumber); // æ¸¬è©¦ç”¨ï¼Œå¯¦éš›éŠæˆ²æ‡‰éš±è—
        }

        function createGameBoard() {
            gameBoard.innerHTML = '';
            const cellsPerRow = 10; // æ¯è¡Œ 10 å€‹æ•¸å­—
            const numRows = Math.ceil(maxNumber / cellsPerRow);

            for (let i = 0; i < numRows; i++) {
                const row = gameBoard.insertRow();
                for (let j = 0; j < cellsPerRow; j++) {
                    const cell = row.insertCell();
                    const num = i * cellsPerRow + j + 1; // å¾ 1 é–‹å§‹
                    cell.setAttribute('data-value', num);
                    if (num <= maxNumber) {
                        cell.innerHTML = `<span>${num}</span>`;
                        cell.onclick = () => handleGuess(num, cell);
                    } else {
                        // è¶…å‡ºæœ€å¤§å€¼çš„æ ¼å­éš±è—æˆ–ç¦ç”¨
                        cell.style.visibility = 'hidden'; 
                        cell.innerHTML = '';
                    }
                }
            }
            updateBoardState(); // åˆå§‹åŒ–æ£‹ç›¤ç‹€æ…‹ (å•Ÿç”¨/ç¦ç”¨)
        }

        function updateBoardState() {
            const allCells = gameBoard.querySelectorAll('td');
            allCells.forEach(cell => {
                const num = parseInt(cell.getAttribute('data-value'));
                if (num >= lowerBound && num <= upperBound) {
                    cell.classList.remove('disabled');
                    // é‡æ–°ç¶å®šäº‹ä»¶ï¼Œé˜²æ­¢è¢«ä¹‹å‰ disableAllCells æˆ–å…¶ä»–æ“ä½œè§£é™¤
                    if (cell.innerHTML !== '') { // ç¢ºä¿ä¸æ˜¯ç©ºå–®å…ƒæ ¼
                       cell.onclick = () => handleGuess(num, cell); 
                    }
                } else {
                    cell.classList.add('disabled');
                    cell.onclick = null; // ç§»é™¤é»æ“Šäº‹ä»¶
                }
            });
            currentRangeDisplay.textContent = `${lowerBound} - ${upperBound}`;
        }

        function handleGuess(guess, cell) {
            hideMessage(gameMessageDisplay); // æ¸…é™¤ä¹‹å‰çš„æç¤º

            // æ’­æ”¾é»æ“Šå‹•ç•«
            cell.classList.add('selected');
            // ç”±æ–¼ selected class æœƒç¦ç”¨ pointer-eventsï¼Œç¢ºä¿å‹•ç•«çµæŸå¾Œç§»é™¤
            setTimeout(() => {
                cell.classList.remove('selected');
                // å¦‚æœéŠæˆ²é‚„åœ¨é€²è¡Œï¼Œä¸”æ­¤å–®å…ƒæ ¼ä¸æ˜¯çµ‚æ¥µå¯†ç¢¼ï¼Œå¯èƒ½éœ€è¦é‡æ–°å•Ÿç”¨é»æ“Šï¼ˆä½†å› ç‚ºæœƒè¢« disabled è¦†è“‹ï¼Œé€™è£¡ä¸é‚£éº¼é—œéµï¼‰
                // æ›´å¥½çš„åšæ³•æ˜¯è®“ updateBoardState çµ±ä¸€è™•ç†
            }, 100); 

            if (guess === secretNumber) {
                showMessage(winMessageDisplay, `æ­å–œç©å®¶ ${playerTurn}ï¼ä½ çŒœä¸­äº†çµ‚æ¥µå¯†ç¢¼ ${secretNumber}ï¼ğŸ‰`, true);
                updateLastGuessInfo(`ç©å®¶ ${playerTurn} çŒœä¸­ ${secretNumber}ï¼Œç²å‹ï¼`); // ä½¿ç”¨æ–°å‡½æ•¸
                disableAllCells(); // éŠæˆ²çµæŸï¼Œç¦ç”¨æ‰€æœ‰æ ¼å­
                resetButton.style.display = 'block';
                return;
            }

            if (guess < secretNumber) {
                if (guess >= lowerBound) { // ç¢ºä¿çŒœæ¸¬æ•¸å­—åœ¨æœ‰æ•ˆç¯„åœå…§æ‰æ›´æ–°
                    lowerBound = guess + 1;
                    updateLastGuessInfo(`ç©å®¶ ${playerTurn} çŒœ ${guess}ã€‚å¤ªå°äº†ï¼ç¯„åœæ›´æ–°ç‚º ${lowerBound} - ${upperBound}`); // ä½¿ç”¨æ–°å‡½æ•¸
                } else {
                     // å¦‚æœçŒœæ¸¬æ•¸å­—å·²ç¶“åœ¨èˆŠçš„ç¦ç”¨ç¯„åœå…§ï¼Œå‰‡ä¸æ›´æ–°ç¯„åœï¼Œä½†ä»é¡¯ç¤ºæç¤º
                    showMessage(gameMessageDisplay, `ç©å®¶ ${playerTurn} çŒœ ${guess}ã€‚é€™å€‹æ•¸å­—å·²ç¶“ä¸åœ¨æœ‰æ•ˆç¯„åœå…§äº†ï¼`);
                }
            } else { // guess > secretNumber
                if (guess <= upperBound) { // ç¢ºä¿çŒœæ¸¬æ•¸å­—åœ¨æœ‰æ•ˆç¯„åœå…§æ‰æ›´æ–°
                    upperBound = guess - 1;
                    updateLastGuessInfo(`ç©å®¶ ${playerTurn} çŒœ ${guess}ã€‚å¤ªå¤§äº†ï¼ç¯„åœæ›´æ–°ç‚º ${lowerBound} - ${upperBound}`); // ä½¿ç”¨æ–°å‡½æ•¸
                } else {
                    showMessage(gameMessageDisplay, `ç©å®¶ ${playerTurn} çŒœ ${guess}ã€‚é€™å€‹æ•¸å­—å·²ç¶“ä¸åœ¨æœ‰æ•ˆç¯„åœå…§äº†ï¼`);
                }
            }

            // æ›´æ–°æ£‹ç›¤ç‹€æ…‹
            updateBoardState();

            // æª¢æŸ¥æ˜¯å¦é‚„æœ‰æœ‰æ•ˆæ•¸å­—å¯é¸
            if (lowerBound > upperBound) {
                showMessage(gameMessageDisplay, `æ²’æœ‰å¯é¸çš„æ•¸å­—äº†ï¼Œçµ‚æ¥µå¯†ç¢¼æ˜¯ ${secretNumber}ã€‚éŠæˆ²çµæŸï¼`);
                disableAllCells();
                resetButton.style.display = 'block';
                return;
            }

            // åˆ‡æ›ç©å®¶
            playerTurn = (playerTurn % numPlayers) + 1;
            playerTurnDisplay.textContent = `ç©å®¶ ${playerTurn}`;
        }

        function disableAllCells() {
            gameBoard.querySelectorAll('td').forEach(cell => {
                cell.classList.add('disabled');
                cell.onclick = null;
            });
        }

        function updateGameDisplay() {
            currentRangeDisplay.textContent = `${lowerBound} - ${upperBound}`;
            playerTurnDisplay.textContent = `ç©å®¶ ${playerTurn}`;
            // é€™è£¡ä¹Ÿç”¨æ–°å‡½æ•¸ä¾†è¨­å®šåˆå§‹æ–‡å­—
            updateLastGuessInfo('è«‹é¸æ“‡ä¸€å€‹æ•¸å­—');
            hideMessage(gameMessageDisplay);
            hideMessage(winMessageDisplay);
            resetButton.style.display = 'none';
        }

        function resetGame() {
            // currentSum = 0; // é€™å€‹è®Šæ•¸æ˜¯å¾åŠ æ³•è›‡éŠæˆ²ä¸­ç•™ä¸‹çš„ï¼Œå¯ä»¥ç§»é™¤æˆ–ä¸ä½¿ç”¨
            playerTurn = 1;
            lowerBound = 1;
            upperBound = maxNumber; // é‡è¨­ç‚ºåˆå§‹æœ€å¤§å€¼
            generateSecretNumber(); // é‡æ–°ç”Ÿæˆå¯†ç¢¼

            updateGameDisplay();
            createGameBoard(); // é‡æ–°å»ºç«‹æ£‹ç›¤
            
            gameSettingsSection.style.display = 'block';
            gameInfoAndBoardSection.style.display = 'none'; 
            maxNumberInput.disabled = false;
            numPlayersInput.disabled = false;
            startGameButton.disabled = false;
        }

        function startGame() {
            const enteredMaxNumber = parseInt(maxNumberInput.value);
            const enteredNumPlayers = parseInt(numPlayersInput.value);

            if (isNaN(enteredMaxNumber) || enteredMaxNumber < 10) {
                showMessage(gameMessageDisplay, "æ•¸å­—æœ€å¤§å€¼è‡³å°‘è¦ 10ï¼");
                return;
            }
            if (isNaN(enteredNumPlayers) || enteredNumPlayers < 2 || enteredNumPlayers > 6) {
                showMessage(gameMessageDisplay, "ç©å®¶äººæ•¸è«‹è¼¸å…¥ 2 åˆ° 6 ä¹‹é–“ï¼");
                return;
            }

            maxNumber = enteredMaxNumber;
            numPlayers = enteredNumPlayers;
            
            // åˆå§‹åŒ–éŠæˆ²è®Šæ•¸
            lowerBound = 1;
            upperBound = maxNumber;
            playerTurn = 1;
            
            generateSecretNumber(); // ç”Ÿæˆçµ‚æ¥µå¯†ç¢¼

            gameSettingsSection.style.display = 'none';
            gameInfoAndBoardSection.style.display = 'flex'; 

            maxNumberInput.disabled = true;
            numPlayersInput.disabled = true;
            startGameButton.disabled = true;

            createGameBoard(); // å»ºç«‹éŠæˆ²æ¿
            updateGameDisplay(); // æ›´æ–°é¡¯ç¤º
        }

        // Initial state: show settings, hide game
        gameInfoAndBoardSection.style.display = 'none'; 
        gameSettingsSection.style.display = 'block';
        
        // Ensure initial range display is correct on load
        currentRangeDisplay.textContent = `${lowerBound} - ${upperBound}`;
    </script>
</body>
</html>